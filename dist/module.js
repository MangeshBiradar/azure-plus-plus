define(["react","lodash","@grafana/data","@grafana/ui","@grafana/runtime"],(function(e,t,r,n,a){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=5)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t,r){"use strict";r.r(t);var n=r(2),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function s(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t,r,n){return new(r||(r=Promise))((function(a,s){function o(e){try{u(n.next(e))}catch(e){s(e)}}function i(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}u((n=n.apply(e,t||[])).next())}))}function u(e,t){var r,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}var l=r(1),c=function(e){this.id="",this.subscriptionId="",this.tenantId="",this.displayName="",this.name="",e&&(this.id=e.id||e.subscriptionId,this.subscriptionId=e.subscriptionId||e.id,this.tenantId=e.tenantId,this.displayName=e.displayName,this.name=e.name||e.displayName||"")},p=r(4),m=function e(t,r){return void 0===r&&(r=1),Object(p.getBackendSrv)().datasourceRequest(t).catch((function(n){return r>0?e(t,r-1):(console.error("Error while retreiving data from "+t.url,n),{})}))},f=function(){function e(e){this.instanceSettings=e,this.subscriptions=[],this.baseUrl=e.url,this.cloudName=e.jsonData.cloudName||"azuremonitor"}return e.$inject=["instanceSettings"],e.prototype.getSubscriptions=function(){return i(this,void 0,void 0,(function(){var e,t=this;return u(this,(function(r){return this.subscriptions.length>0?[2,new Promise((function(e){e(t.subscriptions)}))]:(e={method:"GET",url:this.baseUrl+"/"+this.cloudName+"/subscriptions?api-version=2018-01-01"},[2,m(e,2).then((function(e){return e&&200===e.status&&e.data&&e.data.value?(t.subscriptions=(e.data.value||[]).map((function(e){return new c(e)})),t.subscriptions):(console.error("Invalid response received for getSubscriptions query",e),t.subscriptions)})).catch((function(e){return console.error(e),t.subscriptions}))])}))}))},e}(),h=function(e,t){this.refId=e,this.query=t},g=function(e,t){return e=(e||[]).map((function(e,t){return e.text=e.name||t,e.type="integer"===e.type?"number":e.type||"string",e})),t=(t||[]).map((function(t){return t.map((function(t,r){return e[r]&&"number"===e[r].type?+t:"string"==typeof t?t:JSON.stringify(t)}))})),{columns:e,rows:t,type:"table"}},d=function(e){var t=[];return e&&e.rows&&e.rows.forEach((function(e){if(2===e.length){var r=e[0],n=e[1];t.push({text:r,value:n})}else e.forEach((function(e){var r=e,n=e;t.push({text:r,value:n})}))})),t},v=function(e){var t=e[0]||{};return t.rows=Object(l.uniq)(Object(l.flatten)(e.map((function(e){return e.rows})))),t},y=function(e){var t,r,n=this;this.output={columns:[],refId:"",rows:[],type:"table"},r=[],e.forEach((function(e){e.result&&e.result.data&&e.result.data.tables?(e.result.data.tables||[]).forEach((function(e){e.columns&&3===e.columns.length&&e.columns.find((function(e){return"datetime"===e.type}))&&e.columns.find((function(e){return"string"===e.type}))&&e.columns.find((function(e){return"long"===e.type}))||e.columns&&2===e.columns.length&&e.columns.find((function(e){return"datetime"===e.type}))&&e.columns.find((function(e){return"long"===e.type}))?r.push("time_series"):r.push("table")})):e.result&&e.result.data&&e.result.data.data&&r.push("table")})),Object(l.every)(r,(function(e){return"time_series"===e}))?(this.output.type="time_series",this.output=(t=[],e.forEach((function(e){e.result&&e.result.data&&e.result.data.tables&&(e.result.data.tables||[]).forEach((function(e){var r=function(e){var t={};return e.columns.forEach((function(e,r){"datetime"===e.type?(t.timestamp={},t.timestamp.name=e.name,t.timestamp.index=r):"string"===e.type?(t.metricname={},t.metricname.name=e.name,t.metricname.index=r):"long"===e.type&&(t.value={},t.value.name=e.name,t.value.index=r)})),function(e){return!(e.columns&&e.columns.length>=3&&e.columns.find((function(e){return"datetime"===e.type}))&&e.columns.find((function(e){return"string"===e.type}))&&e.columns.find((function(e){return"long"===e.type}))||(e.columns&&e.columns.length>=2&&e.columns.find((function(e){return"datetime"===e.type}))&&e.columns.find((function(e){return"long"===e.type})),0))}(e)&&(t.metricname={},t.metricname.name=t.value.name||"metric",t.metricname.index=-1),t}(e);if(-1===r.metricname.index){var n={};n.target=r.value.name,n.datapoints=[],e.rows.forEach((function(e){n.datapoints.push([e[r.value.index],new Date(e[r.timestamp.index]).getTime()])})),t.push(n)}else Object(l.uniq)(e.rows.map((function(e){return e[r.metricname.index]}))).forEach((function(n){var a={};a.target=n,a.datapoints=[],e.rows.forEach((function(e){e[r.metricname.index]===n&&a.datapoints.push([e[r.value.index],new Date(e[r.timestamp.index]).getTime()])})),t.push(a)}))}))})),t),this.output=this.output.map((function(e){return e.datapoints=Object(l.sortBy)(e.datapoints,[function(e){return e[1]}]),e}))):(this.output.type="table",e.forEach((function(e){if(e.result&&e.result.data&&e.result.data.tables)(t=e.result.data.tables||[]).forEach((function(t){var r=g(t.columns,t.rows);n.output.columns=r.columns,n.output.rows=[].concat(n.output.rows,r.rows),n.output.refId=e.query.refId}));else if(e.result&&e.result.data&&e.result.data.data){var t=e.result.data.data||{},r=g(t.columns,t.rows);n.output.columns=r.columns,n.output.rows=[].concat(n.output.rows,r.rows),n.output.refId=e.query.refId}})))},b=r(0),C=r.n(b),A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onResourceGraphQueryChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureResourceGraph;i.query=r,s(o(o({},a),{azureResourceGraph:i}))},t.onResourceGraphTopChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureResourceGraph;i.top=r,s(o(o({},a),{azureResourceGraph:i}))},t.onResourceGraphSkipChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureResourceGraph;i.skip=r,s(o(o({},a),{azureResourceGraph:i}))},t}return s(t,e),t.prototype.render=function(){var e=this.props.query;return C.a.createElement("div",null,C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Resource Graph Query"},"Query"),C.a.createElement("textarea",{value:e.azureResourceGraph.query||"",onChange:this.onResourceGraphQueryChange,className:"gf-form-input min-width-30 width-30",rows:10})))),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Top"},"Top"),C.a.createElement("input",{className:"gf-form-input width-9",type:"text",onChange:this.onResourceGraphTopChange,value:e.azureResourceGraph.top,placeholder:"1000",title:"Top N Results. Default / Max is 1000"}),C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"width-1"})),C.a.createElement("label",{className:"gf-form-label width-12",title:"Skip"},"Skip"),C.a.createElement("input",{className:"gf-form-input width-9",type:"text",onChange:this.onResourceGraphSkipChange,value:e.azureResourceGraph.skip,placeholder:"0",title:"Skip N Results. Default 0"}))))))},t}(b.PureComponent),N={query:"",top:1e3,skip:0},w=function(e){function t(t,r,n,a,s){void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=1e3),void 0===a&&(a=0),void 0===s&&(s=[]);var o=e.call(this,t,r)||this;return o.top=n,o.skip=a,o.subscriptions=s,o}return s(t,e),t}(h),E=function(){function e(e,t){this.azureConnection=e,this.templateSrv=t,this.allSubscriptions=[],this.url=e.instanceSettings.url,this.baseUrl="/"+e.instanceSettings.jsonData.cloudName}return e.$inject=["azureConnection","templateSrv"],e.prototype.doResourceGraphRequest=function(e,t){return void 0===t&&(t=1),i(this,void 0,void 0,(function(){var r,n,a,s;return u(this,(function(o){switch(o.label){case 0:return r=[],0!==this.allSubscriptions.length?[3,2]:(n=this,[4,this.azureConnection.getSubscriptions()]);case 1:n.allSubscriptions=o.sent(),o.label=2;case 2:return r=this.allSubscriptions.map((function(e){return e.subscriptionId.toString()})),e.subscriptions.indexOf("all")<0&&(a=e.subscriptions.filter((function(e){return"all"!==e}))).length>0&&(r=a),s={data:{options:{$skip:e.skip||0,$top:e.top||100,resultFormat:"table"},query:e.query,subscriptions:r},headers:{"Content-Type":"application/json"},method:"POST",url:this.url+this.baseUrl+"/providers/Microsoft.ResourceGraph/resources?api-version=2019-04-01"},[2,m(s,t)]}}))}))},e.prototype.doQueries=function(e){var t=this;return e.map((function(e){return t.doResourceGraphRequest(e).then((function(t){return{result:t,query:e}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.query=function(e){return i(this,void 0,void 0,(function(){var t,r,n=this;return u(this,(function(a){return(t=e.targets.filter((function(e){return!0!==e.hide&&e.azureResourceGraph&&e.azureResourceGraph.query})).map((function(t){var r=t.azureResourceGraph;return new w(t.refId,n.templateSrv.replace(r.query,e.scopedVars),r.top||1e3,r.skip||0,r.subscriptions||["all"])})))&&0!==t.length?(r=this.doQueries(t),[2,Promise.all(r).then((function(e){return new y(e).output}))]):[2]}))}))},e.prototype.simpleQuery=function(e,t,r,n,a){if(void 0===t&&(t="SimpleQuery"),void 0===r&&(r=1e3),void 0===n&&(n=0),void 0===a&&(a=["all"]),e){var s=[new w(t,e,r,n,a)],o=this.doQueries(s);return Promise.all(o).then((function(e){return new y(e).output}))}},e.prototype.batchQuery=function(e,t,r,n){return void 0===r&&(r=[]),void 0===n&&(n=0),i(this,void 0,void 0,(function(){var a;return u(this,(function(s){switch(s.label){case 0:return[4,this.simpleQuery(e,"",1e3,n)];case 1:return a=s.sent(),r.push(a),t>0&&a&&a.rows&&a.rows.length>=1e3?[4,this.batchQuery(e,t-1,r,n+1e3)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2,v(r)]}}))}))},e.prototype.metricFindQuery=function(e,t){if(void 0===t&&(t="MetricFindQuery"),e.startsWith("ResourceGraph(")&&e.endsWith(")")){var r=e.replace("ResourceGraph(","").slice(0,-1),n=new w(t,this.templateSrv.replace(r),1e3,0,["all"]),a=this.doQueries([n]);return Promise.all(a).then((function(e){var t=new y(e);return d(t.output)}))}if(e.startsWith("Subscriptions(")&&e.endsWith(")")){r='resourcecontainers | where type == "microsoft.resources/subscriptions" | distinct name, subscriptionId | order by name asc',n=new w(t,this.templateSrv.replace(r),1e3,0,["all"]),a=this.doQueries([n]);return Promise.all(a).then((function(e){var t=new y(e);return d(t.output)}))}if(e.startsWith("ResourceGroups(")&&e.endsWith(")")){var s=e.replace("ResourceGroups(","").slice(0,-1);r="";r=s?'resourcecontainers | where type != "microsoft.resources/subscriptions" and subscriptionId == "'+s+'" | distinct name | order by name asc':'resourcecontainers | where type != "microsoft.resources/subscriptions" | distinct name | order by name asc';n=new w(t,this.templateSrv.replace(r),1e3,0,["all"]),a=this.doQueries([n]);return Promise.all(a).then((function(e){var t=new y(e);return d(t.output)}))}},e}(),S=function(e,t,r,n,a){if(void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=""),void 0===a&&(a=""),this.id="",this.subscriptionId="",this.resourceGroup="",this.type="",this.name="",e){var s=e.split("/");this.id=e,this.subscriptionId=s[2],this.resourceGroup=s[4],this.type=s.filter((function(e,t){return e&&t>=6&&t!==s.length-1})).join("/"),this.name=s[s.length-1]}else r&&n&&a&&(this.id="/subscriptions/"+t+"/resourceGroups/"+r+"/providers/"+n+"/"+a)},z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAppInsightsAppIDChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureAppInsights;i.appInsightsAppId=r,s(o(o({},a),{azureAppInsights:i}))},t.onAppInsightsQueryChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureAppInsights;i.query=r,s(o(o({},a),{azureAppInsights:i}))},t}return s(t,e),t.prototype.render=function(){var e=this.props.query;return C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Top"},"Application Insights ID"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:this.onAppInsightsAppIDChange,value:e.azureAppInsights.appInsightsAppId||"",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",title:"AppInsights ID"})))),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Application Insights Query"},"Query"),C.a.createElement("textarea",{value:e.azureAppInsights.query||"",onChange:this.onAppInsightsQueryChange,className:"gf-form-input min-width-30 width-30",rows:10})))))},t}(b.PureComponent),I={appInsightsAppId:"",query:""},q=function(e){function t(t,r,n,a){void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=""),void 0===a&&(a="");var s=e.call(this,t,a)||this;return s.resourceId=r,s.resource=new S(r),s.appInsightsAppId=n,s.query=a,s}return s(t,e),t}(h),X=function(){function e(e,t){this.azureConnection=e,this.templateSrv=t,this.url=this.azureConnection.instanceSettings.url,this.baseUrl="/"+this.azureConnection.instanceSettings.jsonData.cloudName}return e.$inject=["azureConnection","templateSrv"],e.prototype.doApplicationInsightsRequest=function(e,t){return void 0===t&&(t=1),i(this,void 0,void 0,(function(){var r;return u(this,(function(n){return r={data:{query:e.query},headers:{"Content-Type":"application/json"},method:"POST",url:this.url+this.baseUrl+e.resourceId+"/query?api-version=2018-04-20"},e.appInsightsAppId&&(r.url=this.url+"/applicationinsights/v1/apps/"+e.appInsightsAppId+"/query?api-version=2018-04-20"),[2,m(r,t)]}))}))},e.prototype.doQueries=function(e){var t=this;return e.map((function(e){return t.doApplicationInsightsRequest(e).then((function(t){return{result:t,query:e}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.query=function(e){return i(this,void 0,void 0,(function(){var t,r,n=this;return u(this,(function(a){return(t=e.targets.filter((function(e){var t=e.azureAppInsights;return!0!==e.hide&&t&&t.query&&(t.resourceId||t.appInsightsAppId)})).map((function(t){var r=t.azureAppInsights;return new q(t.refId,n.templateSrv.replace(r.resourceId,e.scopedVars),n.templateSrv.replace(r.appInsightsAppId,e.scopedVars),n.templateSrv.replace(r.query,e.scopedVars))})))&&0!==t.length?(r=this.doQueries(t),[2,Promise.all(r).then((function(e){return new y(e).output}))]):[2]}))}))},e.prototype.metricFindQuery=function(e){},e}(),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onLAWorkspaceIDChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureLogAnalytics;i.workspace=r,s(o(o({},a),{azureLogAnalytics:i}))},t.onLAQueryChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureLogAnalytics;i.query=r,s(o(o({},a),{azureLogAnalytics:i}))},t}return s(t,e),t.prototype.render=function(){var e=this.props.query;return C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Workspace ID"},"Workspace ID"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:this.onLAWorkspaceIDChange,value:e.azureLogAnalytics.workspace||"",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",title:"Log Analytics workspace ID"})))),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Log Analytics Query"},"Query"),C.a.createElement("textarea",{value:e.azureLogAnalytics.query||"",onChange:this.onLAQueryChange,className:"gf-form-input min-width-30 width-30",rows:10})))))},t}(b.PureComponent),D={workspace:"",query:""},G=function(e){function t(t,r,n,a){void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=""),void 0===a&&(a="");var s=e.call(this,t,a)||this;return s.resourceId=r,s.resource=new S(r),s.workspace=n,s.query=a,s}return s(t,e),t}(h),O=function(){function e(e,t){this.azureConnection=e,this.templateSrv=t,this.url=this.azureConnection.instanceSettings.url,this.baseUrl="/"+this.azureConnection.instanceSettings.jsonData.cloudName}return e.$inject=["azureConnection","templateSrv"],e.prototype.doLogAnalyticsRequest=function(e,t){return void 0===t&&(t=1),i(this,void 0,void 0,(function(){var r;return u(this,(function(n){return r={data:{query:e.query},headers:{"Content-Type":"application/json"},method:"POST",url:this.url+this.baseUrl+e.resourceId+"/query?api-version=2017-10-01"},e.workspace&&(r.url=this.url+"/loganalytics/v1/workspaces/"+e.workspace+"/query?api-version=2017-10-01"),[2,m(r,t)]}))}))},e.prototype.doQueries=function(e){var t=this;return e.map((function(e){return t.doLogAnalyticsRequest(e).then((function(t){return{result:t,query:e}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.query=function(e){return i(this,void 0,void 0,(function(){var t,r,n=this;return u(this,(function(a){return(t=e.targets.filter((function(e){var t=e.azureLogAnalytics;return!0!==e.hide&&t&&t.query&&(t.resourceId||t.workspace)})).map((function(t){var r=t.azureLogAnalytics;return new G(t.refId,n.templateSrv.replace(r.resourceId,e.scopedVars),n.templateSrv.replace(r.workspace,e.scopedVars),n.templateSrv.replace(r.query,e.scopedVars))})))&&0!==t.length?(r=this.doQueries(t),[2,Promise.all(r).then((function(e){return new y(e).output}))]):[2]}))}))},e.prototype.metricFindQuery=function(e){},e}(),R=function(e,t,r){var n=2,a="";if(this.timestamp=new Date,this.cost=e[0],"None"===r.granularity)this.timestamp=new Date(r.query.range.from),n--;else if("Daily"===r.granularity){var s=e[2].toString(),o=s.substring(0,4),i=s.substring(4,6),u=s.substring(6,8);this.timestamp=new Date(o,i-1,u)}else"Monthly"===r.granularity&&(this.timestamp=new Date(e[2]));a=r.data.dataSet.grouping?r.data.dataSet.grouping[0]&&"TagKey"===r.data.dataSet.grouping[0].type?e.filter((function(t,r){return r<e.length-1&&r>n+1})).map((function(e){return e||"-"})).join(":").trim():e.filter((function(t,r){return r<e.length-1&&r>n})).map((function(e){return e||"-"})).join(":").trim():"cost",this.label=a,r.rawquery.alias&&"{{default}}"!==r.rawquery.alias&&(r.rawquery.alias.indexOf("{{default}}")>-1||"cost"===this.label)&&(this.label=r.rawquery.alias,this.label=this.label.replace(/{{default}}/g,a),this.label=this.label.replace(/{{metric}}/g,a),this.label=this.label.replace(/{{subscription}}/g,r.rawquery.subscriptionName||r.rawquery.subscriptionId),this.label=this.label.replace(/{{subscriptionname}}/g,r.rawquery.subscriptionName||r.rawquery.subscriptionId),this.label=this.label.replace(/{{subscriptionid}}/g,r.rawquery.subscriptionId))},j=function(e){var t=this;this.output=[];var r=[];e.forEach((function(e){e&&e.result&&e.result.data&&e.result.data.properties&&e.result.data.properties.rows&&e.result.data.properties.rows.forEach((function(t){r.push(new R(t,e.result.data.properties.columns,e.query))}))})),Object(l.uniq)(r.map((function(e){return e.label}))).forEach((function(e){var n={target:e||"-",datapoints:[]};n.datapoints=r.filter((function(t){return t.label===e})).map((function(e){return[e.cost,e.timestamp]})).sort((function(e,t){return e[1]-t[1]})),t.output.push(n)})),this.output=this.output.sort((function(e,t){return t.target-e.target}))},x=r(3),F=[{value:"ManagementGroup",label:"Management Group"},{value:"Subscription",label:"Subscription"},{value:"ResourceGroup",label:"ResourceGroup"}],P=[{value:"None",label:"None"},{value:"Daily",label:"Daily"},{value:"Monthly",label:"Monthly"}],V=[{value:"None",label:"None"},{value:"Dimension",label:"Dimension"},{value:"TagKey",label:"Tag"}],k=[{value:"ResourceId",label:"Resource"},{value:"ResourceType",label:"Resource Type"},{value:"ResourceLocation",label:"Resource Location"},{value:"ResourceGroupName",label:"Resource Group Name"},{value:"ServiceName",label:"Service Name"},{value:"ServiceTier",label:"Service Tier"},{value:"Meter",label:"Meter"},{value:"MeterCategory",label:"Meter Category"},{value:"MeterSubCategory",label:"Meter SubCategory"},{value:"PricingModel",label:"Pricing Model"},{value:"PublisherType",label:"Publisher Type"},{value:"ChargeType",label:"Charge Type"},{value:"SubscriptionId",label:"Subscription ID"},{value:"SubscriptionName",label:"Subscription Name"}],Q=[{value:"None",label:"None"},{value:"Dimensions",label:"Dimensions"},{value:"Tags",label:"Tags"}],M=[{value:"In",label:"In"}],L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=Object(l.defaults)(t.state,{AzureSubscriptions:[]}),t.onACASubscriptionIDChange=function(e){var r=e.value,n=t.props,a=n.query,s=n.onChange,i=a.azureCostAnalysis;i.subscriptionId=r,i.subscriptionName=e.label,s(o(o({},a),{azureCostAnalysis:i}))},t.onACAScopeChange=function(e){var r=t.props,n=r.query,a=r.onChange,s=n.azureCostAnalysis;s.scope=e.value,a(o(o({},n),{azureCostAnalysis:s}))},t.onACAManagementGroupNameChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureCostAnalysis;i.managementGroupId=r,s(o(o({},a),{azureCostAnalysis:i}))},t.onACAResourceGroupNameChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureCostAnalysis;i.resourceGroupName=r,s(o(o({},a),{azureCostAnalysis:i}))},t}return s(t,e),t.prototype.componentWillMount=function(){var e=this;0===this.state.AzureSubscriptions.length&&new f(this.props.datasource.instanceSettings).getSubscriptions().then((function(t){e.setState({AzureSubscriptions:t.map((function(e){return{value:e.subscriptionId,label:e.name}}))})}))},t.prototype.render=function(){var e,t=this.props.query,r=C.a.createElement("div",null);return"ResourceGroup"===t.azureCostAnalysis.scope&&(r=C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Resource Group Name"},"Resource Group"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",value:t.azureCostAnalysis.resourceGroupName,placeholder:"Resource Group Name",title:"Resource Group Name",onChange:this.onACAResourceGroupNameChange}))),"Subscription"===t.azureCostAnalysis.scope||"ResourceGroup"===t.azureCostAnalysis.scope?e=C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Subscription"},"Subscription"),C.a.createElement(x.Select,{className:"width-24",value:this.state.AzureSubscriptions.find((function(e){return e.value===t.azureCostAnalysis.subscriptionId}))||{label:t.azureCostAnalysis.subscriptionId,value:t.azureCostAnalysis.subscriptionId},allowCustomValue:!0,options:this.state.AzureSubscriptions,defaultValue:t.azureCostAnalysis.subscriptionId,onChange:this.onACASubscriptionIDChange})),r))):"ManagementGroup"===t.azureCostAnalysis.scope&&(e=C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Management Group ID"},"Management group ID"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",value:t.azureCostAnalysis.managementGroupId,placeholder:"Management Group ID",title:"Management Group ID",onChange:this.onACAManagementGroupNameChange})))))),C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Scope"},"Scope"),C.a.createElement(x.Select,{className:"width-24",value:F.find((function(e){return e.value===t.azureCostAnalysis.scope})),options:F,defaultValue:t.azureCostAnalysis.scope,onChange:this.onACAScopeChange})))),C.a.createElement("div",null,e))},t}(b.PureComponent),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onACAGranularityChange=function(e){var r=t.props,n=r.query,a=r.onChange,s=n.azureCostAnalysis;s.granularity=e.value,a(o(o({},n),{azureCostAnalysis:s}))},t}return s(t,e),t.prototype.render=function(){var e=this.props.query;return C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Granularity"},"Granularity"),C.a.createElement(x.Select,{className:"width-24",value:P.find((function(t){return t.value===e.azureCostAnalysis.granularity})),options:P,defaultValue:e.azureCostAnalysis.granularity,onChange:this.onACAGranularityChange}))))},t}(b.PureComponent),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onACAGroupingTypeChange=function(e){var r=e.value,n=t.props,a=n.query,s=n.onChange,i=a.azureCostAnalysis;i.grouping=i.grouping||{type:"Dimension",name:"ServiceName"},i.grouping[0].type=r,s(o(o({},a),{azureCostAnalysis:i}))},t.onACAGroupingNameChange=function(e){var r=e.target.value,n=t.props,a=n.query,s=n.onChange,i=a.azureCostAnalysis;i.grouping=i.grouping||{type:"Dimension",name:"ServiceName"},i.grouping[0].name=r,s(o(o({},a),{azureCostAnalysis:i}))},t.onACAGroupingNameChangeDimension=function(e){var r=e.value,n=t.props,a=n.query,s=n.onChange,i=a.azureCostAnalysis;i.grouping=i.grouping||{type:"Dimension",name:"ServiceName"},i.grouping[0].name=r,s(o(o({},a),{azureCostAnalysis:i}))},t}return s(t,e),t.prototype.render=function(){var e,t=this.props.query;return e="TagKey"===t.azureCostAnalysis.grouping[0].type?C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Tag Name"},"Tag Name"),C.a.createElement("input",{className:"gf-form-input width-12",type:"text",onChange:this.onACAGroupingNameChange,value:t.azureCostAnalysis.grouping[0].name,placeholder:"Tag Name",title:"Tag Name"})))):"Dimension"===t.azureCostAnalysis.grouping[0].type?C.a.createElement("span",null,C.a.createElement(x.Select,{className:"width-12",value:k.find((function(e){return e.value===t.azureCostAnalysis.grouping[0].name})),options:k,defaultValue:t.azureCostAnalysis.grouping[0].name,onChange:this.onACAGroupingNameChangeDimension})):C.a.createElement("div",null),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Group By"},"Group By"),C.a.createElement(x.Select,{className:"width-12",value:V.find((function(e){return e.value===t.azureCostAnalysis.grouping[0].type})),options:V,defaultValue:t.azureCostAnalysis.grouping[0].type,onChange:this.onACAGroupingTypeChange}),C.a.createElement("span",null,e))))},t}(b.PureComponent),H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onACAFilterAdd=function(){var e=t.props,r=e.query,n=e.onChange,a=r.azureCostAnalysis;a.filters=a.filters||[{FilterType:"None",Name:"None",Operator:"In",Values:[]}],a.filters.push({FilterType:"None",Name:"None",Operator:"In",Values:[]}),n(o(o({},r),{azureCostAnalysis:a}))},t.onACAFilterRemove=function(e){var r=t.props,n=r.query,a=r.onChange,s=n.azureCostAnalysis;s.filters=s.filters||[{FilterType:"None",Name:"None",Operator:"In",Values:[]}],s.filters.splice(e,1),a(o(o({},n),{azureCostAnalysis:s}))},t.onACAFilterTypeChange=function(e,r){var n=e.value,a=t.props,s=a.query,i=a.onChange,u=s.azureCostAnalysis;u.filters=u.filters||[{FilterType:"None",Name:"None",Operator:"In",Values:[]}],u.filters[r].FilterType=n,i(o(o({},s),{azureCostAnalysis:u}))},t.onACAFilterNameChange=function(e,r){var n=e.target.value,a=t.props,s=a.query,i=a.onChange,u=s.azureCostAnalysis;u.filters=u.filters||[{FilterType:"None",Name:"None",Operator:"In",Values:[]}],u.filters[r].Name=n,i(o(o({},s),{azureCostAnalysis:u}))},t.onACAFilterNameChangeDimension=function(e,r){var n=e.value,a=t.props,s=a.query,i=a.onChange,u=s.azureCostAnalysis;u.filters=u.filters||[{FilterType:"None",Name:"None",Operator:"In",Values:[]}],u.filters[r].Name=n,i(o(o({},s),{azureCostAnalysis:u}))},t.onACAFilterOperatorChange=function(e,r){var n=e.value,a=t.props,s=a.query,i=a.onChange,u=s.azureCostAnalysis;u.filters=u.filters||[{FilterType:"None",Name:"None",Operator:"In",Values:[]}],u.filters[r].Operator=n,i(o(o({},s),{azureCostAnalysis:u}))},t.onACAFilterValueChange=function(e,r){var n=e.target.value,a=t.props,s=a.query,i=a.onChange,u=s.azureCostAnalysis;u.filters=u.filters||[{FilterType:"None",Name:"None",Operator:"In",Values:[]}],u.filters[r].Values=n.split(","),i(o(o({},s),{azureCostAnalysis:u}))},t}return s(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return C.a.createElement("div",null,0===t.azureCostAnalysis.filters.length?C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Filter"},"Filter"))),C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:this.onACAFilterAdd},"Add Filter")))):null,t.azureCostAnalysis.filters.map((function(t,r){return C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Filter"},"Filter ",r+1))),C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement(x.Select,{className:"width-12",value:Q.find((function(e){return e.value===t.FilterType})),options:Q,defaultValue:t.FilterType,onChange:function(t){return e.onACAFilterTypeChange(t,r)}}))),C.a.createElement("div",null,"None"===t.FilterType?C.a.createElement("span",null,C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:e.onACAFilterAdd},"+"),C.a.createElement("span",{className:"btn btn-danger btn-small",style:{margin:"5px"},onClick:function(){return e.onACAFilterRemove(r)}},"x")))):null,"Dimensions"===t.FilterType?C.a.createElement("span",null,C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement(x.Select,{className:"width-12",value:k.find((function(e){return e.value===t.Name})),options:k,defaultValue:t.Name,onChange:function(t){return e.onACAFilterNameChangeDimension(t,r)}})),C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement(x.Select,{className:"width-12",value:M.find((function(e){return e.value===t.Operator})),options:M,defaultValue:t.Operator,onChange:function(t){return e.onACAFilterOperatorChange(t,r)}})),C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("input",{type:"text",className:"gf-form-input width-12",title:"Values; Comma separated",placeholder:"Values",value:t.Values.join(","),onChange:function(t){return e.onACAFilterValueChange(t,r)}})),C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:e.onACAFilterAdd},"+"),C.a.createElement("span",{className:"btn btn-danger btn-small",style:{margin:"5px"},onClick:function(){return e.onACAFilterRemove(r)}},"x")))):null,"Tags"===t.FilterType?C.a.createElement("span",null,C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("input",{type:"text",className:"gf-form-input width-12",title:"Tag Name",placeholder:"Tag Name",value:t.Name,onChange:function(t){return e.onACAFilterNameChange(t,r)}})),C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement(x.Select,{className:"width-12",value:M.find((function(e){return e.value===t.Operator})),options:M,defaultValue:t.Operator,onChange:function(t){return e.onACAFilterOperatorChange(t,r)}})),C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("input",{type:"text",className:"gf-form-input width-12",title:"Tags; Comma separated",placeholder:"Tags",value:t.Values.join(","),onChange:function(t){return e.onACAFilterValueChange(t,r)}})),C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:e.onACAFilterAdd},"+"),C.a.createElement("span",{className:"btn btn-danger btn-small",style:{margin:"5px"},onClick:function(){return e.onACAFilterRemove(r)}},"x")))):null))})))},t}(b.PureComponent),W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onACAAliasChange=function(e){var r=t.props,n=r.query,a=r.onChange,s=n.azureCostAnalysis;s.alias=e.target.value,a(o(o({},n),{azureCostAnalysis:s}))},t}return s(t,e),t.prototype.render=function(){var e=this.props.query;return C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Leave blank for default. Or refer as {{default}} for default value"},"Alias"),C.a.createElement("input",{className:"gf-form-input width-24",value:e.azureCostAnalysis.alias,onChange:this.onACAAliasChange,type:"text"}))))},t}(b.PureComponent),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.render=function(){var e=this.props,t=e.query,r=e.onChange,n=e.datasource;return C.a.createElement("div",null,C.a.createElement(L,{query:t,onChange:r,datasource:n}),C.a.createElement(_,{query:t,onChange:r}),C.a.createElement(U,{query:t,onChange:r}),C.a.createElement(H,{query:t,onChange:r}),C.a.createElement(W,{query:t,onChange:r}))},t}(b.PureComponent),J={alias:"",scope:"Subscription",managementGroupId:"",subscriptionId:"",subscriptionName:"",resourceGroupName:"",granularity:"Daily",grouping:[{type:"None",name:"None"}],filters:[{FilterType:"None",Name:"None",Operator:"In",Values:[]}]},K=function(e,t){this.type="ActualCost",this.timeframe="Custom",this.timePeriod={from:new Date(e.from).toISOString(),to:new Date(e.to).toISOString()},this.dataSet=t},B=function(e){function t(t,r,n,a){void 0===t&&(t="");var s=e.call(this,t,r)||this;s.scope=a.replace("/subscriptions/"+n.subscriptionId,r.scopedVars),s.granularity=a.replace(n.granularity||"Monthly",r.scopedVars),s.rawquery=n,s.rawquery.alias=a.replace(s.rawquery.alias,r.scopedVars),"Subscription"===s.rawquery.scope?s.scope=a.replace("/subscriptions/"+n.subscriptionId,r.scopedVars):"ManagementGroup"===s.rawquery.scope?s.scope=a.replace("/providers/Microsoft.Management/managementGroups/"+n.managementGroupId,r.scopedVars):"ResourceGroup"===s.rawquery.scope&&(s.scope=a.replace("/subscriptions/"+n.subscriptionId+"/resourceGroups/"+n.resourceGroupName,r.scopedVars));var o;if(o=n.grouping&&n.grouping.length>0?n.grouping:[{type:"Dimension",name:"ServiceName"}],s.data=new K(r.range,{granularity:s.granularity,aggregation:{totalCost:{name:"PreTaxCost",function:"Sum"},totalCostUSD:{name:"PreTaxCostUSD",function:"Sum"}},sorting:[{direction:"ascending",name:"UsageDate"}],grouping:o}),o&&o.length>0&&"None"===o[0].type&&delete s.data.dataSet.grouping,n.filters=n.filters.filter((function(e){return e&&"None"!==e.FilterType})).map((function(e){return e.Values=[a.replace(""+e.Values)],e})),n.filters&&n.filters.length>0&&"None"!==n.filters[0].FilterType){if(1===n.filters.length){var i={};i[n.filters[0].FilterType]=n.filters[0],delete i[n.filters[0].FilterType].FilterType,s.data.dataSet.filter=i}else if(n.filters.length>0){var u={And:[]};n.filters.forEach((function(e){var t={};t[e.FilterType]=e,delete t[e.FilterType].FilterType,u.And.push(t)})),s.data.dataSet.filter=u}}else n.filter&&(s.data.dataSet.filter=n.filter);return s}return s(t,e),t}(h),Y=function(){function e(e,t){this.azureConnection=e,this.templateSrv=t,this.url=this.azureConnection.instanceSettings.url,this.baseUrl="/"+this.azureConnection.instanceSettings.jsonData.cloudName}return e.$inject=["azureConnection","templateSrv"],e.prototype.doCostRequest=function(e,t){return void 0===t&&(t=1),i(this,void 0,void 0,(function(){var r;return u(this,(function(n){return r={data:e.data,headers:{"Content-Type":"application/json"},method:"POST",url:this.url+this.baseUrl+e.scope+"/providers/Microsoft.CostManagement/query?api-version=2019-11-01&$top=10000"},[2,m(r,t)]}))}))},e.prototype.doQueries=function(e){var t=this;return e.map((function(e){return t.doCostRequest(e).then((function(t){return{result:t,query:e}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.query=function(e){return i(this,void 0,void 0,(function(){var t,r,n=this;return u(this,(function(a){return(t=e.targets.filter((function(e){var t=e.azureCostAnalysis;return!0!==e.hide&&t})).map((function(t){var r=t.azureCostAnalysis;return new B(t.refId,e,r,n.templateSrv)})))&&0!==t.length?(r=this.doQueries(t),[2,Promise.all(r).then((function(e){return new j(e).output}))]):[2]}))}))},e.prototype.metricFindQuery=function(e){},e}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ee=function(e){var t=this;this.output={columns:[],refId:"",rows:[],type:"table"},e.forEach((function(e){e&&e.result&&e.result.data&&e.result.data.value&&e.result.data.value.forEach((function(e,r){if(console.log(e),0===r){var n=[];Object(l.forEach)(e,(function(e,t){if("properties"!==t){var r=Z(t);n.push({text:t,type:t.toLowerCase().indexOf("timestamp")>-1?"datetime":r})}})),n.push({text:"title",type:"string"}),t.output.columns=n}var a=[];Object(l.forEach)(e,(function(e,t,r){var n="";if("string"==typeof e&&t.toLowerCase().indexOf("timestamp")>-1)n=new Date(e).toISOString();else if("string"==typeof e)n=e||"-";else if("object"===Z(e)&&(e.value||e.localizedValue||""===e.value))n=e.localizedValue||"-";else try{n=JSON.stringify(e)||"-"}catch(t){n=e}"properties"===t||a.push(n)})),Object(l.forEach)(e,(function(e,t,r){"properties"===t&&a.push(e.title)})),t.output.rows.push(a)}))})),console.log(this.output)},te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=Object(l.defaults)(t.state,{AzureSubscriptions:[]}),t.onASCSubscriptionIDChange=function(e){var r=e.value,n=t.props,a=n.query,s=n.onChange,i=a.azureServiceHealth;i.subscriptionId=r,s(o(o({},a),{azureCostAnalysis:i}))},t}return s(t,e),t.prototype.componentWillMount=function(){var e=this;0===this.state.AzureSubscriptions.length&&new f(this.props.datasource.instanceSettings).getSubscriptions().then((function(t){e.setState({AzureSubscriptions:t.map((function(e){return{value:e.subscriptionId,label:e.name}}))})}))},t.prototype.render=function(){var e=this.props.query;return C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Subscription"},"Subscription"),C.a.createElement(x.Select,{className:"width-24",value:this.state.AzureSubscriptions.find((function(t){return t.value===e.azureCostAnalysis.subscriptionId}))||{label:e.azureCostAnalysis.subscriptionId,value:e.azureCostAnalysis.subscriptionId},allowCustomValue:!0,options:this.state.AzureSubscriptions,defaultValue:e.azureCostAnalysis.subscriptionId,onChange:this.onASCSubscriptionIDChange}))))},t}(b.PureComponent),re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.render=function(){var e=this.props,t=e.query,r=e.onChange,n=e.datasource;return C.a.createElement("div",null,C.a.createElement(te,{query:t,onChange:r,datasource:n}))},t}(b.PureComponent),ne={subscriptionId:""},ae=function(e){function t(t,r,n,a){void 0===t&&(t=""),void 0===r&&(r="");var s=e.call(this,t,"")||this;s.subscriptionId=r;var o=n.toISOString(),i=a.toISOString();return s.filter="eventTimestamp ge '"+o+"' and eventTimestamp le '"+i+"' and categories eq 'ServiceHealth'",s}return s(t,e),t}(h),se=function(){function e(e,t){this.azureConnection=e,this.templateSrv=t,this.url=this.azureConnection.instanceSettings.url,this.baseUrl="/"+this.azureConnection.instanceSettings.jsonData.cloudName}return e.$inject=["azureConnection","templateSrv"],e.prototype.doServiceHealthRequest=function(e,t){return void 0===t&&(t=1),i(this,void 0,void 0,(function(){var r;return u(this,(function(n){return r={headers:{"Content-Type":"application/json"},method:"GET",url:this.url+this.baseUrl+"/subscriptions/"+e.subscriptionId+"/providers/microsoft.insights/eventtypes/management/values?api-version=2017-03-01-preview&$filter="+e.filter},[2,m(r,t)]}))}))},e.prototype.doQueries=function(e){var t=this;return e.map((function(e){return t.doServiceHealthRequest(e).then((function(t){return{result:t,query:e}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.query=function(e){return i(this,void 0,void 0,(function(){var t,r,n=this;return u(this,(function(a){return(t=e.targets.filter((function(e){var t=e.azureServiceHealth;return!0!==e.hide&&t&&t.subscriptionId})).map((function(t){var r=t.azureServiceHealth;return new ae(t.refId,n.templateSrv.replace(r.subscriptionId,e.scopedVars),e.range.from,e.range.to)})))&&0!==t.length?(r=this.doQueries(t),[2,Promise.all(r).then((function(e){return new ee(e).output}))]):[2]}))}))},e.prototype.metricFindQuery=function(e){},e}(),oe=[{value:"Azure Resource Graph",label:"Azure Resource Graph"},{value:"Azure Cost Analysis",label:"Azure Cost Analysis"},{value:"Azure Service Health",label:"Azure Service Health"},{value:"Azure Application Insights",label:"Azure Application Insights - unstable"},{value:"Azure Log Analytics",label:"Azure Log Analytics - unstable"}],ie=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"germanyazuremonitor",label:"Azure Germany"},{value:"chinaazuremonitor",label:"Azure China"}],ue=function(e){function t(t,r){var n=e.call(this,t)||this;n.instanceSettings=t,n.templateSrv=r;var a=new f(n.instanceSettings);return n.azureResourceGraphDatasource=new E(a,n.templateSrv),n.azureApplicationInsightsDatasource=new X(a,n.templateSrv),n.azureLogAnalyticsDatasource=new O(a,n.templateSrv),n.azureConstAnalysisDatasource=new Y(a,n.templateSrv),n.azureServiceHealthDatasource=new se(a,n.templateSrv),n}return t.$inject=["instanceSettings","templateSrv"],s(t,e),t.prototype.query=function(e){var t=[],r=Object(l.cloneDeep)(e);(r.targets=Object(l.filter)(r.targets,["queryType","Azure Resource Graph"]),r.targets.length>0)&&((s=this.azureResourceGraphDatasource.query(r))&&t.push(s));var n=Object(l.cloneDeep)(e);(n.targets=Object(l.filter)(n.targets,["queryType","Azure Service Health"]),n.targets.length>0)&&((s=this.azureServiceHealthDatasource.query(n))&&t.push(s));var a=Object(l.cloneDeep)(e);(a.targets=Object(l.filter)(a.targets,["queryType","Azure Application Insights"]),a.targets.length>0)&&((s=this.azureApplicationInsightsDatasource.query(a))&&t.push(s));var s,o=Object(l.cloneDeep)(e);(o.targets=Object(l.filter)(o.targets,["queryType","Azure Log Analytics"]),o.targets.length>0)&&((s=this.azureLogAnalyticsDatasource.query(o))&&t.push(s));var i=Object(l.cloneDeep)(e);if(i.targets=Object(l.filter)(i.targets,["queryType","Azure Cost Analysis"]),i.targets.length>0){var u=this.azureConstAnalysisDatasource.query(i);u&&t.push(u)}return Promise.all(t).then((function(e){return{data:Object(l.flatten)(e)}}))},t.prototype.testDatasource=function(){var e=this;return new Promise((function(t,r){return i(e,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,new f(this.instanceSettings).getSubscriptions()];case 1:return(e=n.sent())&&e.length>0?t({message:"Successfully Connected Azure Monitor. "+e.length+" subscriptions found.",status:"success"}):r({message:"Failed to connect.",status:"error"}),[3,3];case 2:return n.sent(),r({message:"Failed to Connect.",status:"error"}),[3,3];case 3:return[2]}}))}))}))},t.prototype.metricFindQuery=function(e){if(!e)return Promise.resolve([]);var t=this.azureResourceGraphDatasource.metricFindQuery(e);return t||Promise.resolve([])},t}(n.DataSourceApi),le=ie,ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCloudNameChange=function(e){var r=t.props,n=r.onOptionsChange,a=r.options,s=o(o({},a.jsonData),{cloudName:e.value});n(o(o({},a),{jsonData:s}))},t.onTenantIdChange=function(e){var r=t.props,n=r.onOptionsChange,a=r.options,s=o(o({},a.jsonData),{tenantId:e.target.value});n(o(o({},a),{jsonData:s}))},t.onClientIdChange=function(e){var r=t.props,n=r.onOptionsChange,a=r.options,s=o(o({},a.jsonData),{clientId:e.target.value});n(o(o({},a),{jsonData:s}))},t.onClientSecretChange=function(e){var r=t.props,n=r.onOptionsChange,a=r.options;n(o(o({},a),{secureJsonData:{clientSecret:e.target.value}}))},t.onResetClientSecret=function(){var e=t.props,r=e.onOptionsChange,n=e.options;r(o(o({},n),{secureJsonFields:o(o({},n.secureJsonFields),{clientSecret:!1}),secureJsonData:o(o({},n.secureJsonData),{clientSecret:""})}))},t}return s(t,e),t.prototype.render=function(){var e=this.props.options,t=e.secureJsonData||{};e.jsonData.cloudName=e.jsonData.cloudName||"azuremonitor";var r=e.jsonData,n=e.secureJsonFields;return C.a.createElement("div",{className:"gf-form-group"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-10",title:"Choose an Azure cloud Type"},"Cloud Type"),C.a.createElement(x.Select,{className:"width-24",value:le.find((function(e){return e.value===r.cloudName})),options:le,defaultValue:r.cloudName,onChange:this.onCloudNameChange})),C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-10",title:"Tenant ID"},"Tenant ID"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:this.onTenantIdChange,value:r.tenantId||"",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"})),C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-10",title:"Client ID"},"Client ID"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:this.onClientIdChange,value:r.clientId||"",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"})),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-10",title:"API Key"},"API Key"),n&&n.clientSecret?C.a.createElement(C.a.Fragment,null,C.a.createElement("label",{className:"gf-form-label width-18"},"Configured"),C.a.createElement("span",{className:"gf-form-button btn btn-secondary width-6",onClick:this.onResetClientSecret},"Reset")):C.a.createElement("input",{type:"password",value:t.clientSecret||"",className:"gf-form-input width-24",onChange:this.onClientSecretChange}))))},t}(b.PureComponent),pe=oe,me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onServiceTypeChange=function(e){var r=t.props,n=r.query;(0,r.onChange)(o(o({},n),{queryType:e.value}))},t}return s(t,e),t.prototype.render=function(){var e,t=Object(l.defaults)(this.props.query,{azureResourceGraph:Object(l.defaults)(this.props.query.azureResourceGraph,N),azureAppInsights:Object(l.defaults)(this.props.query.azureAppInsights,I),azureLogAnalytics:Object(l.defaults)(this.props.query.azureAppInsights,D),azureCostAnalysis:Object(l.defaults)(this.props.query.azureCostAnalysis,J),azureServiceHealth:Object(l.defaults)(this.props.query.azureServiceHealth,ne)});switch(t.queryType){case"Azure Resource Graph":e=C.a.createElement(A,{onChange:this.props.onChange,query:t,datasource:this.props.datasource});break;case"Azure Application Insights":e=C.a.createElement(z,{onChange:this.props.onChange,query:t,datasource:this.props.datasource});break;case"Azure Log Analytics":e=C.a.createElement(T,{onChange:this.props.onChange,query:t,datasource:this.props.datasource});break;case"Azure Cost Analysis":e=C.a.createElement($,{onChange:this.props.onChange,query:t,datasource:this.props.datasource});break;case"Azure Service Health":e=C.a.createElement(re,{onChange:this.props.onChange,query:t,datasource:this.props.datasource})}return C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-12",title:"Service Type"},"Service"),C.a.createElement(x.Select,{className:"width-24",value:pe.find((function(e){return e.value===t.queryType})),options:pe,defaultValue:t.queryType,onChange:this.onServiceTypeChange}))),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},e)))},t}(b.PureComponent);r.d(t,"plugin",(function(){return fe}));var fe=new n.DataSourcePlugin(ue).setConfigEditor(ce).setQueryEditor(me)}])}));